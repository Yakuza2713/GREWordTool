<!DOCTYPE html>
<html>
<head>
<title>GRE Word Practice</title>

<style>
body {
    background: #121212;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
}
select, button {
    padding: 10px;
    background: #1e1e1e;
    color: white;
    border: 1px solid #444;
    border-radius: 5px;
}
#fileSelect {
    min-width: 220px;
}
#counter {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 18px;
    text-align: right;
    line-height: 1.4;
}
#wordBox {
    margin-top: 60px;
    font-size: 70px;     /* BIGGER WORD */
    font-weight: bold;
}
#meaningBox {
    margin-top: 20px;
    font-size: 24px;
    color: #cfcfcf;
    display: none;
}
#resultsBox {
    display:none;
    margin-top:20px;
    padding:20px;
    background:#1d1d1d;
    border:1px solid #444;
    border-radius:10px;
    max-width: 800px;
    margin-left:auto;
    margin-right:auto;
}
</style>
</head>

<body>

<h1>GRE Word Practice</h1>

<p>Select one or more sets (or ALL):</p>

<select id="fileSelect" multiple size="6">
    <option value="ALL">ALL (all files)</option>
    {% for f in files %}
        <option value="{{f}}">{{f}}</option>
    {% endfor %}
</select>

<button onclick="startSession()">Start</button>

<div id="counter"></div>

<div id="wordBox"></div>

<div onclick="toggleMeaning()" style="font-size:40px; cursor:pointer; margin-top:10px;">
    üëÅÔ∏è‚Äçüó®Ô∏è
</div>

<div id="meaningBox"></div>

<div style="margin-top:20px;">
    <button onclick="mark('right')" style="padding:12px; background:#0a7d28;">Right ‚úì</button>
    <button onclick="mark('wrong')" style="padding:12px; background:#7d0000;">Wrong ‚úó</button>
</div>

<button onclick="stopSession()" style="margin-top:20px; padding:12px; background:#8b0000;">STOP</button>

<div style="margin-top:20px;">
    <button onclick="viewResults('right')">View Right ‚úì</button>
    <button onclick="viewResults('wrong')">View Wrong ‚úó</button>
</div>

<div id="resultsBox"></div>


<script>
let words = [];
let index = 0;
let active = false;
let totalWords = 0;
let rightCount = 0;
let wrongCount = 0;
let lastOpened = "";  // tracks which results panel is open

function startSession() {
    const select = document.getElementById("fileSelect");
    const selected = Array.from(select.selectedOptions).map(o => o.value);

    let filesValue = selected.includes("ALL") ? "ALL" : selected.join(",");

    fetch("/start", {
        method: "POST",
        body: new URLSearchParams({ files: filesValue })
    })
    .then(res => res.json())
    .then(data => {
        words = data.words;
        totalWords = data.total;

        index = 0;
        rightCount = 0;
        wrongCount = 0;
        active = true;

        updateCounter();
        showWord();
    });
}

function showWord() {
    document.getElementById("wordBox").innerHTML = words[index].word;
    document.getElementById("meaningBox").innerHTML = words[index].meaning;
    document.getElementById("meaningBox").style.display = "none";
}

function toggleMeaning() {
    const box = document.getElementById("meaningBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
}

function mark(status) {
    if (!active) return;

    if (status === "right") rightCount++;
    else wrongCount++;

    fetch("/save_result", {
        method: "POST",
        body: new URLSearchParams({
            word: words[index].word,
            meaning: words[index].meaning,
            status: status
        })
    });

    index++;
    updateCounter();

    if (index >= words.length) {
        active = false;
        alert("Done!");
        return;
    }
    showWord();
}

function stopSession() {
    active = false;
    alert("Stopped.");
}

function updateCounter() {
    document.getElementById("counter").innerHTML =
        `${index} / ${totalWords} words done<br>` +
        `Right - ${rightCount}<br>` +
        `Wrong - ${wrongCount}`;
}

function viewResults(type) {
    const box = document.getElementById("resultsBox");

    // Collapse if same button clicked again
    if (lastOpened === type && box.style.display === "block") {
        box.style.display = "none";
        lastOpened = "";
        return;
    }

    lastOpened = type; // set new open panel

    fetch(`/get_results?file=${type}`)
        .then(res => res.json())
        .then(rows => {
            let html = `<h3>${type.toUpperCase()} WORDS</h3>`;
            if (rows.length === 0) {
                html += "<p>No entries yet.</p>";
            } else {
                html += "<table style='margin:auto; color:white; border-collapse:collapse;'>";
                html += "<tr><th>Word</th><th>Meaning</th></tr>";
                rows.forEach(r => {
                    html += `<tr>
                        <td style='padding:6px;border-top:1px solid #444'>${r.word}</td>
                        <td style='padding:6px;border-top:1px solid #444'>${r.meaning}</td>
                    </tr>`;
                });
                html += "</table>";
            }

            box.style.display = "block";
            box.innerHTML = html;
        });
}
</script>

</body>
</html>